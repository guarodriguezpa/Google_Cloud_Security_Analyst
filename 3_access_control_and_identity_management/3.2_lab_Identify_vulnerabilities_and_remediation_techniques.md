# **Identify vulnerabilities and remediation techniques**

**Web Application Vulnerability Scanning and Remediation with Google
Cloud Web Security Scanner (Google Cloud Lab)**

In this Google Cloud lab, I addressed a critical security concern for
Cymbal Bank: **identifying and mitigating vulnerabilities in a new
banking application** before its public launch. As a Cloud Security
Analyst, my core objective was to proactively scan the application for
weaknesses, specifically focusing on Cross-Site Scripting (XSS)
vulnerabilities, a top OWASP® concern.

My actions involved several steps to simulate a real-world scenario. I
began by **creating a static IP address and launching a virtual machine
(VM)** to host the application.

I then **deployed the vulnerable banking application** onto this VM and
**set up and ran the application** to prepare it for testing.

A key part of this task was using **Google Cloud Web Security Scanner to
access and scan the deployed application** for vulnerabilities. After
the initial scan, I proceeded to **fix the identified vulnerabilities**
within the application\'s code or configuration. Finally, I **re-scanned
the application** to confirm that the security issues were resolved.

This lab strengthened my skills in **web application security,
vulnerability scanning (specifically with Google Cloud Web Security
Scanner), identifying OWASP Top 10 vulnerabilities like XSS, and the
full cycle of vulnerability remediation and verification**.

It provided hands-on experience in proactive security testing and
ensuring application readiness before deployment, which is vital for
protecting sensitive customer data and maintaining an organization\'s
reputation. The outcome was a **more secure banking application**, ready
for launch with identified vulnerabilities addressed.

## Task 1. Launch a virtual machine

In this task, you'll create a static IP address and launch the virtual
machine to run the vulnerable application.

1.  On the Google Cloud console title bar, click the **Activate Cloud
    Shell** (![Activate Cloud Shell
    icon](media/image1.png){width="0.15625in"
    height="0.13541666666666666in"}) icon. If prompted,
    click **Continue**.

2.  Copy the following command into the Cloud Shell terminal:

\####

gcloud compute addresses create xss-test-ip-address \--region=\"REGION\"

\#####

This command creates a static IP address named xss-test-ip-address in
the **REGION** region. This static IP will be used for scanning the
vulnerable web application.

3.  Press **ENTER**.

![](media/image2.png){width="6.152397200349956in"
height="2.8378969816272965in"}

4.  Copy the following command into the Cloud Shell terminal:

\#####

gcloud compute addresses describe xss-test-ip-address \\

\--region=\"REGION\" \--format=\"value(address)\"

\#####

This command returns the static IP address you generated.

5.  Press **ENTER**.

6.  Copy the **IP address** from the output and save it in a notepad.
    You'll need to use this in a later task.

![](media/image3.png){width="6.703503937007874in"
height="3.1160203412073493in"}

7.  Copy the following command into the Cloud Shell terminal:

\#####

gcloud compute instances create xss-test-vm-instance
\--address=xss-test-ip-address \--no-service-account \\

\--no-scopes \--machine-type=e2-micro \--zone=\"ZONE\" \\

\--metadata=startup-script=\'apt-get update; apt-get install -y
python3-flask\'

\#####

This command creates a VM instance to run the vulnerable application.

8.  Press **ENTER**.

![](media/image4.png){width="7.156435914260717in"
height="2.5431397637795277in"}

**Task 2. Set up and run the vulnerable application**

In this task, you'll download and extract the web application files for
the vulnerable application, and then deploy the application in the
SSH-in-browser.

**First**, you'll create a firewall rule that will allow Web Security
Scanner to access the vulnerable application.

1.  Copy the following command into the Cloud Shell terminal:

\####

gcloud compute firewall-rules create enable-wss-scan \\

\--direction=INGRESS \--priority=1000 \\

\--network=default \--action=ALLOW \\

\--rules=tcp:8080 \--source-ranges=0.0.0.0/0

\####

This command creates a firewall rule that allows access to the web
application from any source IP address. This allows the Web Security
Scanner to access the vulnerable application and perform a scan.

2.  Press **ENTER**.

**Next**, use an SSH connection to connect to the VM instance.
![](media/image5.png){width="7.10221019247594in"
height="2.1203488626421696in"}

3.  In the Google Cloud console, click the **Navigation
    Menu** (![Navigation Menu](media/image6.png){width="0.15625in"
    height="0.13541666666666666in"}).

4.  Select **Compute Engine** \> **VM instances**.

5.  On the **VM instances** page, in the **Connect** column, click on
    the **SSH** button next to your test instance.

This will open an SSH connection to your VM instance in a new browser
window.

![](media/image7.png){width="6.984469597550306in"
height="2.3867694663167103in"}

6.  A pop-up may appear asking you to allow SSH in-browser to connect to
    VMs. Click **Authorize**.

**Now**, extract the web application files.

7.  Copy the following command into the **SSH-in-browser** page (not in
    Cloud Shell):

\####

gsutil cp gs://cloud-training/GCPSEC-ScannerAppEngine/flask_code.tar .
&& tar xvf flask_code.tar

\#####

This command downloads and extracts the vulnerable web application
files.

8.  Press **Enter**.

![](media/image8.png){width="5.155544619422572in"
height="3.0611832895888016in"}

9.  **Finally**, copy the following command into
    the **SSH-in-browser** page:

\#####

python3 app.py

\####

This command starts the application.

10. Press **ENTER**.

A message should indicate that the application is up and running.

![](media/image9.png){width="7.064457567804024in"
height="3.5180883639545057in"}

**Task 3. Access the vulnerable application**

In this task, you'll test your application for a vulnerability known as
cross-site scripting (XSS). XSS vulnerabilities can be exploited by
malicious scripts, such as HTML code, in content that is then served to
web browsers.

1.  While the application is running, open a new browser window.

2.  Copy the URL below into the browser tab, and
    replace \<YOUR_EXTERNAL_IP\> with the static IP address of the VM
    you saved in a notepad in Task 1:

\#####

http://\<YOUR_EXTERNAL_IP\>:8080

\#######

A Cymbal Bank corporate banking portal with a web form should appear.

![](media/image10.png){width="4.794739720034996in"
height="3.3589074803149606in"}

3.  Copy the following HTML code including the script tags into the web
    form:

\######

\<script\>alert(\'This is an XSS Injection to demonstrate one of OWASP
vulnerabilities\')\</script\>

\######

This code injects an OWASP® vulnerability.

![A web page for Cymbal Bank\'s demo application displays a web form
containing a cross-site scripting
script](media/image11.png){width="5.927083333333333in"
height="3.4166666666666665in"}

4.  Click **POST**.

The injected code displayed a message back to the browser. This action
by itself is not malicious, however attackers can introduce malicious
code into an exploitable application to either steal data from it or
implant malware onto the user\'s device.

The alert window opens with the following message: "This is an XSS
Injection to demonstrate one of OWASP vulnerabilities".

Which security vulnerability is associated with actions performed in
this task?

Ransomware

Cross-Site Request Forgery (CSRF)

SQL Injection

Cross-Site Scripting (XSS)

Submit

**Task 4. Scan the application**

In this task, you'll scan the application for vulnerabilities using the
Web Security Scanner.

**First**, enable the Web Security Scanner API.

1.  In the Google Cloud console, click the **Navigation
    menu** (![Navigation Menu](media/image6.png){width="0.15625in"
    height="0.13541666666666666in"}).

2.  Select **APIs & Services** \> **Enabled APIs and services**.
    The **APIs & Services** page displays.

3.  Click **+ Enable APIs and services**.

4.  In the search field, type **Web Security Scanner**, and
    press **ENTER**.

5.  Select **Web Security Scanner API**.

6.  Click **Enable**.

**Now**, scan the application for vulnerabilities.

![](media/image12.png){width="5.212101924759405in"
height="3.151865704286964in"}

7.  In the Google Cloud console, click the **Navigation menu \> View All
    Products** (![Navigation Menu](media/image6.png){width="0.15625in"
    height="0.13541666666666666in"}).

8.  Select **Security** \> **Web Security Scanner**.

If the **Web Security Scanner API** is enabled then the Cloud Web
Security Scanner page displays the **Scan configs** details.

9.  In the **Cloud Web Security Scanner** toolbar, click **+ New scan**.

10. In the **Name** section, name the scan **Cross-Site Scripting
    scan**.

In the **Starting URLs** section, the **Starting URLs 1** field should
be pre-populated with your static IP address.

11. Add a colon and the port number **8080** at the end of the IP
    address. The **Starting URL 1** should resemble the following:

\####

http://\<EXTERNAL_IP\>:8080

\####

12. If present, delete **Starting URL 2**.

13. In the **Excluded URLs** section, verify that **Authentication** is
    set to **None**, and **Schedule** set to **Never**. Leave all other
    fields unchanged.

14. Click **Save** to create the scan.

![](media/image13.png){width="5.083509405074365in"
height="3.853970909886264in"}

15. Click **Run Scan** to start the scan.

16. Return to the **SSH-in-browser** window.

![](media/image14.png){width="5.818877952755906in"
height="3.474468503937008in"}

In the **SSH-in-browser** window, you should view logs being generated
as Web Security Scanner tests all possible URLs for potential
vulnerabilities.

![](media/image15.png){width="6.087158792650919in"
height="4.827863079615048in"}

17. When the scan is complete, return to the Google Cloud console.

***Note: **The scan might take 5-10 minutes to complete.*

The **Results** tab should indicate the cross-site vulnerabilities,
demonstrating how Web Security Scanner can detect a XSS vulnerability.

The vulnerabilities can also be found in the **Vulnerabilities** tab
under the **Security Command Centre**.

![](media/image16.png){width="5.882047244094488in"
height="3.836220472440945in"}

**Task 5. Remediate the vulnerabilities**

In this task, you\'ll remediate the application\'s XSS vulnerability and
re-run the application with the new fix.

The recommendation for fixing the current vulnerabilities is to validate
and escape untrusted user-supplied data, which also points to the
corresponding OWASP^®^ rules.

You will do this by editing the code of the vulnerable application to
include lines of code that validate and escape the user-supplied data.

1.  Return to the **SSH-in-browser** page connected to your VM instance.

2.  Press **CTRL + C** to stop the running application. Alternatively,
    you can click the **Send key combination** icon on the top right
    corner of the SSH-in-browser window to input the **CTRL + C** key
    combination.

**Now**, edit the **app.py** file using the nano editor.

3.  Copy the following command into the **SSH-in-browser** page:

nano app.py

Copied!

content_copy

This command opens the nano code editor.

4.  Press **ENTER**.

![](media/image17.png){width="6.045832239720035in"
height="5.933114610673666in"}

5.  To fix the XSS vulnerability, you validate the output string
    variable. The output string is the processed output of the
    user-supplied web form input.

Ensure that the application does not accept user input as HTML code,
instead, it will escape special characters supplied by user input. To do
this, locate the two lines that set the output string:

\# output_string = \"\".join(\[html_escape_table.get(c, c) for c in
input_string\])

output_string = input_string

Copied!

content_copy

6.  Remove the **\#** symbol from the first line, and add it to the
    beginning of the next line (ensure that you indent your code
    properly.) The final lines must resemble the following:

\@app.route(\'/output\')

def output():

output_string = \"\".join(\[html_escape_table.get(c, c) for c in
input_string\])

\# output_string = input_string

return flask.render_template(\"output.html\", output=output_string)

Copied!

content_copy

![](media/image18.png){width="4.9937270341207345in"
height="5.662195975503062in"}

![](media/image19.png){width="4.728338801399825in"
height="5.231246719160105in"}

7.  Press **CTRL + X** to exit nano, then **Y** to save your changes,
    and then **ENTER** to save your changes.

8.  Copy the following command into the **SSH-in-browser** terminal:

python3 app.py

Copied!

content_copy

This command re-runs the application.

9.  Press **ENTER**.

Click **Check my progress** to verify that you have completed this task
correctly.

**Task 6. Re-scan the web application**

In this task, you'll re-scan the application to make sure there are no
vulnerabilities.

1.  Return to the **Cloud Web Security Scanner** page in the Google
    Cloud console.

2.  Click **Run** to re-run the scan.

***Note: **The scan might take 5-10 minutes to complete.*

The **Results** tab should now indicate that there are no
vulnerabilities found.

Click **Check my progress** to verify that you have completed this task
correctly. Be sure you wait until the scan completes to get credit for
completing this task.

![](media/image20.png){width="3.141509186351706in"
height="2.755604768153981in"}

Re-scan the web application

Check my progress

**Conclusion**

Great work!

Through this lab, you gained practical experience in scanning for
application vulnerabilities. You learned the importance of a security
analyst\'s ability to scan for application vulnerabilities, which is
essential for helping identify and address potential weaknesses,
managing risks, meeting compliance requirements, and ultimately,
maintaining a robust security posture to protect an organization's
assets and reputation.

By closing security gaps and addressing weaknesses, you can help prevent
potential exploitation, minimize the impact of security incidents, and
maintain compliance with industry regulations.

In this lab, you completed one of the fundamental aspects of proactive
cybersecurity strategies.
