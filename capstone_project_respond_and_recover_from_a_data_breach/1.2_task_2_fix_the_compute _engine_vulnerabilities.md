## Task 2. Fix the Compute Engine vulnerabilities

In this task, I\'ll shut down the vulnerable VM **cc-app-01**, and
create a new VM from a snapshot taken before the malware infection. VM
snapshots are effective in restoring the system to a clean state, and
ensures that the new VM will not be infected with the same malware that
compromised the original VM.

1.  In the Google Cloud console, click the **Navigation
    menu** (![navigation_menu](media/image1.png){width="0.15625in"
    height="0.1388888888888889in"}).

2.  Select **Compute Engine \> VM instances**. The VM instances page
    opens.

The current VM **cc-app-01** should be listed under VM instances. This
is the vulnerable VM that has been compromised and must be shut down.

3.  Select the checkbox for the **cc-app-01** VM.

4.  Click **Stop**.

5.  A pop-up will appear asking you to confirm that the VM should be
    stopped, click **Stop**.

![](media/image2.png){width="7.138491907261592in"
height="3.9337160979877517in"}

![](media/image3.png){width="7.242020997375328in"
height="2.7486734470691165in"}

![](media/image4.png){width="6.767404855643044in"
height="4.8645133420822395in"}

Shut down the vulnerable VM

**Next**, create a new VM from a snapshot. This snapshot has already
been created as part of Cymbal Retail\'s long term data backup plan.

6.  In the action bar, click **+ Create instance**.

7.  In the **Name** field, type **cc-app-02**.

![](media/image5.png){width="6.892981189851269in"
height="4.791926946631671in"}

8.  In the **Machine type** section, expand the drop-down,
    select **Shared-core**, and then select **e2-medium**.

![](media/image6.png){width="6.900754593175853in"
height="4.638220691163604in"}

![](media/image7.png){width="6.414898293963255in"
height="3.761619641294838in"}

9.  Click **OS and storage**.

![](media/image8.png){width="5.68175634295713in"
height="5.19994750656168in"}

10. In the **Operating system and storage** section, click **Change**.
    The Boot disk dialog opens.

11. Select the **Snapshots** tab.

12. Expand the **Snapshot** drop-down menu, and
    select **cc-app01-snapshot**.

13. Click **Select**.

![](media/image9.png){width="6.4223939195100614in"
height="5.1822900262467195in"}

14. Click **Security**.

15. In the **Identity and API access** section, expand the **Service
    accounts** drop-down menu, and select **Qwiklabs User Service
    Account**.

![](media/image10.png){width="6.85782261592301in"
height="5.3633213035870515in"}

16. Click **Networking**.

17. In the **Network tags** field, type **cc**. You\'ll use this tag to
    apply firewall rules to this specific VM.

18. In the **Network interfaces** section, expand
    the **default** network.

19. Expand the **External IPv4 address** drop-down menu, and
    select **None**.

20. Click **Create**.

The new VM **cc-app-02** should now be created from
the **cc-app01-snapshot.** (It may take a few minutes for the new VM to
be created.)

![](media/image11.png){width="7.1827449693788274in"
height="3.582020997375328in"}

**Now**, turn Secure Boot on for the new VM **cc-app-02** to address
the **Secure Boot disabled** finding.

20. Select the checkbox for the **cc-app-02** VM.

21. Click **Stop**.

22. A pop-up will appear asking you to confirm that the VM should be
    stopped, click **Stop**.

Wait for the **cc-app-02** VM to be stopped before you continue.

![](media/image12.png){width="7.113851706036745in"
height="3.159873140857393in"}

23. In the **VM instances** section, click the **cc-app-02** link. The
    cc-app-02 page opens.

24. In the **cc-app-02** toolbar, click **Edit.** The Edit cc-app-02
    instance page opens.

![](media/image13.png){width="6.439783464566929in"
height="5.178547681539808in"}

25. Scroll down to the **Security and access** section, and
    under **Shielded VM**, select the checkbox for the **Turn on Secure
    Boot** option. This will address the **Compute secure boot
    disabled** finding.

![](media/image14.png){width="5.337981189851269in"
height="5.225217629046369in"}

26. Click **Save**.

27. In the **Compute Engine** menu, select **VM instances**.

28. Select the checkbox for the **cc-app-02** VM.

29. Click **Start/Resume**.

30. A pop-up will appear asking you to confirm that the VM should be
    started, click **Start**.

![](media/image15.png){width="6.721105643044619in"
height="2.5407425634295713in"}

The **cc-app-02** VM instance will restart and the **Secure Boot
disabled** finding will be remediated.

![](media/image16.png){width="7.065556649168854in"
height="3.8075721784776904in"}

### **Challenge: Delete the compromised VM**

Delete the compromised VM **cc-app-01**.

![](media/image17.png){width="7.127191601049868in"
height="3.7400951443569554in"}

![](media/image18.png){width="7.039653324584427in"
height="4.11222987751531in"}

![](media/image19.png){width="6.917550306211724in"
height="4.362753718285214in"}

By following these steps, you have effectively created a new VM from the
snapshot, ensuring it is free from malware and misconfigurations. You
also deleted the compromised VM, eliminating the source of the security
breach.
